<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AIIMS CRE Paper — Safe Submit</title>
<style>
:root{--primary:#ea580c;--secondary:#c2410c;--bg:#fff7ed;--text:#1f2937;--correct:#16a34a;--wrong:#dc2626}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);padding-bottom:80px}
.container{max-width:900px;margin:0 auto;padding:15px}
header{position:sticky;top:0;background:#fff;padding:12px 15px;border-top:4px solid var(--secondary);display:flex;justify-content:space-between;align-items:center;border-radius:0 0 12px 12px;z-index:5}
h1{margin:0;color:var(--secondary);font-size:1.05rem}
.exam-info{font-size:.78rem;color:#666}
#progress{font-weight:600}
.question-card{background:#fff;margin-top:15px;padding:18px;border-radius:12px;box-shadow:0 1px 4px rgba(0,0,0,.08)}
.question-text{font-weight:600;margin-bottom:12px}
.options-grid{display:flex;flex-direction:column;gap:8px}
.option-label{display:flex;gap:10px;padding:12px;border:1px solid #e5e7eb;border-radius:8px;cursor:pointer}
.option-label.selected{background:#ffedd5;border-color:var(--primary);font-weight:600}
.option-label.correct{border-color:var(--correct);background:#dcfce7;font-weight:600}
.option-label.wrong{border-color:var(--wrong);background:#fee2e2;font-weight:600}
input[type=radio]{accent-color:var(--primary)}
.explanation{margin-top:10px;font-size:.92rem;color:#374151}
.submit-btn{width:100%;padding:14px;margin-top:20px;border-radius:10px;border:0;background:var(--secondary);color:#fff;font-weight:700}

/* modal styles */
.modal-backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);align-items:center;justify-content:center;z-index:50;padding:20px}
.modal{background:#fff;border-radius:12px;padding:18px;max-width:420px;width:100%}
.modal h3{margin:0 0 10px 0}
.modal .row{margin-top:12px}
.btn{display:inline-block;padding:10px 12px;border-radius:8px;border:0;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-muted{background:#f3f4f6;color:#111}
.small{font-size:.9rem;color:#444;margin-top:8px}

/* result modal */
.result-box{text-align:center}
.result-score{font-size:2rem;font-weight:800;color:var(--primary)}
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>AIIMS CRE Paper</h1>
      <div class="exam-info">400 Marks | +4 / -1</div>
    </div>
    <div id="progress">0 / 100</div>
  </header>

  <div id="quiz"></div>

  <button id="submitBtn" class="submit-btn" type="button" disabled>SUBMIT PAPER</button>
</div>

<!-- Submit Confirmation Modal -->
<div id="submitModal" class="modal-backdrop" role="dialog" aria-modal="true">
  <div class="modal" role="document">
    <h3>Confirm Submit</h3>
    <div class="small">Type <b>SUBMIT</b> (uppercase) below to confirm sending your answers. This prevents accidental submits.</div>
    <div class="row">
      <input id="confirmInput" placeholder="Type SUBMIT to confirm" style="width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #e5e7eb">
    </div>
    <div class="row" style="display:flex;gap:8px;justify-content:flex-end">
      <button class="btn btn-muted" onclick="closeSubmitModal()">Cancel</button>
      <button id="confirmSubmitBtn" class="btn btn-primary" onclick="confirmSubmit()" disabled>Confirm Submit</button>
    </div>
  </div>
</div>

<!-- Result Modal -->
<div id="resultModal" class="modal-backdrop">
  <div class="modal result-box">
    <h3>Exam Result</h3>
    <div class="result-score"><span id="scoreVal">0</span>/400</div>
    <div class="small">
      Correct: <b id="corr">0</b> |
      Wrong: <b id="wrong">0</b> |
      Skipped: <b id="skipped">0</b> <br>
      Accuracy: <b id="acc">0</b>%
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;flex-direction:column">
      <button class="btn btn-primary" onclick="startReview()">REVIEW PAPER</button>
      <button class="btn btn-muted" onclick="closeResultModal()">Close</button>
    </div>
  </div>
</div>

<script>
/* ----------------- PUT YOUR questionsDB HERE -----------------
   Paste your full questionsDB array below. Make sure Q31 explanation
   uses escaped quotes (example: \"No Phase Wrap\") or single quotes.
----------------------------------------------------------------- */
const questionsDB = [
    // --- ADVANCED PHYSICS & TUBE PARAMETERS ---
    { id: 1, q: "To double the radiographic density using only kVp, the 15% rule suggests an increase of 15%. However, to *maintain* density while doubling the mAs, the kVp should be decreased by:", options: ["15%", "50%", "10%", "5%"], correct: 0, explanation: "The 15% rule applies inversely. Increasing kVp by 15% doubles density; decreasing kVp by 15% halves density (compensating for a doubled mAs)." },
    { id: 2, q: "The binding energy of the K-shell in Tungsten is 69.5 keV. What is the approximate energy of a K-beta characteristic photon?", options: ["59 keV", "67 keV", "69 keV", "12 keV"], correct: 1, explanation: "K-beta occurs when an N-shell electron (binding energy ~0.6 keV) fills the K-shell vacancy. 69.5 - 0.6 ≈ 67-68 keV." },
    { id: 3, q: "Which voltage waveform has the lowest 'Voltage Ripple'?", options: ["Three-phase 6-pulse", "Three-phase 12-pulse", "High Frequency", "Single phase full wave"], correct: 2, explanation: "High Frequency generators have <1% ripple, offering the highest efficiency." },
    { id: 4, q: "In an Image Intensifier, the 'Minification Gain' is calculated as:", options: ["(Input diameter / Output diameter)²", "Output diameter / Input diameter", "Flux gain x Brightness gain", "Input area x Output area"], correct: 0, explanation: "The ratio of the square of the diameter of the input phosphor to the square of the diameter of the output phosphor." },
    { id: 5, q: "The 'Grid Cut-off' caused by using a focused grid upside down appears as:", options: ["Uniform low density", "Dark stripe in center, light on edges", "Light stripe in center, dark on edges", "Grid lines throughout"], correct: 1, explanation: "Severe cutoff on the peripheral edges, with normal density in the center where the grid lines are perpendicular." },
    { id: 6, q: "Which interaction contributes to 'Fog' on the image but provides no useful diagnostic information?", options: ["Compton Scattering", "Photoelectric Effect", "Coherent Scattering", "Pair Production"], correct: 0, explanation: "Compton scatter changes the direction of the photon without being absorbed, degrading contrast." },
    { id: 7, q: "The 'Dose Area Product' (DAP) meter is usually located:", options: ["Inside the patient", "Under the table", "Attached to the collimator face", "Inside the image receptor"], correct: 2, explanation: "It measures the total radiation energy flowing from the tube to the patient, mounted at the collimator output." },
    { id: 8, q: "The maximum permissible leakage radiation from the tube housing at a distance of 1 meter is:", options: ["100 mR/hr (1 mGy/hr)", "10 mR/hr", "1 R/hr", "500 mR/hr"], correct: 0, explanation: "International standard (IEC/NCRP) limit is 1 mGy/hr (100 mR/hr) at 1 meter at max rating." },
    { id: 9, q: "Geometric unsharpness (Penumbra) can be calculated using the formula:", options: ["Focal Spot x OID / SOD", "Focal Spot x SID / OID", "SID / SOD", "mAs x kVp"], correct: 0, explanation: "P = (FSS x OID) / SOD." },
    { id: 10, q: "In CR, the 'Sampling Frequency' is primarily determined by:", options: ["Laser beam width and scan speed", "Phosphor thickness", "kVp used", "Grid ratio"], correct: 0, explanation: "The distance between laser sampling points determines the pixel pitch and spatial resolution." },
    { id: 11, q: "Which of the following materials has the highest 'Linear Attenuation Coefficient' at diagnostic energies?", options: ["Bone", "Muscle", "Fat", "Air"], correct: 0, explanation: "Bone absorbs the most radiation due to its high density and atomic number (Calcium)." },
    { id: 12, q: "The 'Back-up Timer' in an AEC system should be set to:", options: ["150-200% of the expected mAs", "50% of expected mAs", "Exact expected mAs", "5 seconds"], correct: 0, explanation: "It acts as a safety mechanism to prevent tube overload or patient overexposure if the AEC fails." },
    { id: 13, q: "What is the 'Effective Atomic Number' (Zeff) of human soft tissue?", options: ["7.4", "13.8", "20", "5.2"], correct: 0, explanation: "Soft tissue Zeff is approx 7.4; Bone is ~13.8." },
    { id: 14, q: "A 'Wedge Filter' is best used for which projection?", options: ["AP Foot", "Lateral Skull", "PA Chest", "Lateral Lumbar"], correct: 0, explanation: "To compensate for the difference in thickness between the toes and the tarsal/ankle area." },
    { id: 15, q: "Using a 10cm 'Air Gap' has a cleanup efficiency similar to a grid ratio of:", options: ["5:1", "8:1", "12:1", "16:1"], correct: 1, explanation: "A 10-15cm air gap provides scatter cleanup roughly equivalent to an 8:1 grid." },

    // --- CT PHYSICS & ARTIFACTS ---
    { id: 16, q: "Which kernel type is applied to raw data to produce a 'Bone Window' image?", options: ["High-pass filter (Sharpening)", "Low-pass filter (Smoothing)", "Standard algorithm", "Average intensity"], correct: 0, explanation: "High-pass filters enhance edges and high-contrast structures like bone trabeculae." },
    { id: 17, q: "The 'Partial Volume Effect' artifact can be reduced by:", options: ["Increasing slice thickness", "Decreasing slice thickness", "Increasing pitch", "Reducing kVp"], correct: 1, explanation: "Thinner slices ensure that a voxel contains only one type of tissue, preventing averaging errors." },
    { id: 18, q: "CT Number (HU) is calculated using the linear attenuation coefficient of the tissue (µ_t) and water (µ_w). The formula is:", options: ["1000 x (µ_t - µ_w) / µ_w", "1000 x (µ_t + µ_w) / µ_w", "(µ_t - µ_w) / 1000", "µ_t / µ_w"], correct: 0, explanation: "Standard Hounsfield Unit formula." },
    { id: 19, q: "Which generation of CT scanner introduced the 'Slip Ring' technology allowing for Helical scanning?", options: ["Third Generation", "Fourth Generation", "Sixth Generation", "It was independent of generation"], correct: 0, explanation: "Late 3rd generation scanners introduced slip rings, enabling continuous rotation (Spiral/Helical CT)." },
    { id: 20, q: "Increasing the CT 'Pitch' from 1.0 to 1.5 results in:", options: ["Reduced patient dose and lower resolution", "Higher dose and higher resolution", "No change in dose", "Increased scan time"], correct: 0, explanation: "The table moves faster, so anatomy is scanned with gaps/interpolation, reducing dose but potentially widening the Slice Sensitivity Profile (SSP)." },
    { id: 21, q: "The 'Z-axis modulation' (Tube Current Modulation) reduces dose based on:", options: ["Patient thickness along the body length", "ECG gating", "Heart rate", "Breathing"], correct: 0, explanation: "It adjusts mA dynamically as the scout scan indicates thicker (shoulders/hips) or thinner (lungs) regions." },
    { id: 22, q: "Which artifact is caused by a single faulty detector element in a 3rd gen scanner?", options: ["Ring artifact", "Streak artifact", "Shading artifact", "Cone beam artifact"], correct: 0, explanation: "A bad detector creates a consistent error in every projection, forming a ring in the reconstructed image." },
    { id: 23, q: "Iterative Reconstruction (IR) allows for:", options: ["Dose reduction of 30-50% while maintaining image noise", "Instant image generation", "Higher kVp usage", "Elimination of motion"], correct: 0, explanation: "IR models the physics of the scanner to separate signal from noise better than FBP, allowing lower dose scans." },
    { id: 24, q: "The typical 'Anode Heat Storage Capacity' of a modern CT tube is in the range of:", options: ["100-200 kHU", "2-8 MHU (Million Heat Units)", "10,000 HU", "500 kHU"], correct: 1, explanation: "CT tubes must withstand massive heat loads; modern tubes often have capacities >5 MHU." },
    { id: 25, q: "Cone Beam artifacts are most prominent in:", options: ["Multidetector CT (MDCT) with many rows (>64)", "Single slice CT", "Helical CT", "Axial scanning"], correct: 0, explanation: "As the detector array widens, the beam becomes a cone, causing distortion at the edges if not corrected." },

    // --- MRI PHYSICS & SEQUENCES ---
    { id: 26, q: "The 'Magic Angle' effect (increased signal in tendons) occurs at what angle to the main magnetic field (B0)?", options: ["55 degrees", "90 degrees", "45 degrees", "180 degrees"], correct: 0, explanation: "At ~55°, the dipolar interaction in collagen fibers is minimized, increasing T2* and making tendons appear bright." },
    { id: 27, q: "Which gradient is switched on during the frequency encoding step?", options: ["Readout Gradient", "Phase Encoding Gradient", "Slice Select Gradient", "Shim Gradient"], correct: 0, explanation: "Frequency encoding (Readout) gradient is on while the echo is being sampled." },
    { id: 28, q: "In K-space, the 'Phase Encoding' steps determine the:", options: ["Scan time", "FOV", "Signal to Noise Ratio (only)", "Slice thickness"], correct: 0, explanation: "Scan time = TR x Phase Steps x NEX. More phase steps = longer scan." },
    { id: 29, q: "Susceptibility artifacts are most severe in which pulse sequence?", options: ["Gradient Recalled Echo (GRE)", "Spin Echo (SE)", "Fast Spin Echo (FSE)", "STIR"], correct: 0, explanation: "GRE lacks the 180° refocusing pulse, so it does not correct for T2* dephasing caused by magnetic field inhomogeneities." },
    { id: 30, q: "The 'Larmor Frequency' of Hydrogen at 3.0 Tesla is approx:", options: ["63.86 MHz", "127.7 MHz", "42.58 MHz", "21 MHz"], correct: 1, explanation: "42.58 MHz/T x 3 T ≈ 127.74 MHz." },
    { id: 31, q: "To eliminate 'Aliasing' (Wrap-around) in the phase direction, one can:", options: ["Increase the FOV", "Decrease TR", "Increase TE", "Use a surface coil"], correct: 0, explanation: "Increasing FOV covers the anatomy (\"No Phase Wrap\" options also oversample K-space)." },
    { id: 32, q: "Time of Flight (TOF) MRA relies on:", options: ["Flow-related enhancement", "Phase shift of moving spins", "Contrast injection", "T2 weighting"], correct: 0, explanation: "Fresh, unsaturated blood flowing into the slice appears bright compared to saturated stationary tissue." },
    { id: 33, q: "Specific Absorption Rate (SAR) is proportional to:", options: ["The square of the resonant frequency (B0²)", "B0 directly", "Pulse duration", "TR"], correct: 0, explanation: "Doubling the field strength (1.5T to 3T) increases SAR by a factor of 4 (Square law)." },
    { id: 34, q: "In Fast Spin Echo (FSE), the 'Echo Train Length' (ETL) refers to:", options: ["Number of 180° pulses per TR", "Total scan time", "Distance between echoes", "Length of the magnet"], correct: 0, explanation: "The number of echoes acquired in a single TR period." },
    { id: 35, q: "Diffusion Tensor Imaging (DTI) is used to map:", options: ["White matter tracts", "Blood perfusion", "CSF flow", "Cortical activation"], correct: 0, explanation: "DTI tracks the anisotropic diffusion of water along axons (Tractography)." },

    // --- RADIOGRAPHIC POSITIONING (ADVANCED) ---
    { id: 36, q: "The 'Judet View' (Internal Oblique) primarily demonstrates which column of the acetabulum?", options: ["Posterior Column", "Anterior Column", "Iliopectineal line", "Sacral wing"], correct: 0, explanation: "Internal (Obturator) Oblique = Posterior Column & Anterior Rim. External (Iliac) Oblique = Anterior Column & Posterior Rim." },
    { id: 37, q: "For the 'Stryker Notch' view of the humerus, the hand is placed:", options: ["On the top of the head", "On the hip", "Across the chest", "External rotation"], correct: 0, explanation: "Hand on head allows the beam to project the posterolateral aspect of the humeral head (Hill-Sachs defect)." },
    { id: 38, q: "The 'Garth Method' (Apical Oblique) is used for detecting:", options: ["Posterior Shoulder Dislocation", "AC separation", "Clavicle fracture", "Scapular body fracture"], correct: 0, explanation: "45° oblique, 45° caudal. Good for posterior dislocations and glenoid fractures." },
    { id: 39, q: "Which projection best demonstrates the 'Pisotriquetral' joint space?", options: ["AP Oblique Wrist (20-30 deg supination)", "PA Wrist", "Lateral Wrist", "Gaynor-Hart"], correct: 0, explanation: "AP Oblique with semi-supination separates the pisiform from the triquetrum." },
    { id: 40, q: "The 'Robert's Method' is a specific view for the:", options: ["First Carpometacarpal (CMC) joint", "Scaphoid", "Elbow", "Acromion"], correct: 0, explanation: "AP Axial of the thumb base (Bennet's fracture)." },
    { id: 41, q: "For a 'Sunrise' patella view, if the patient cannot flex knees, the alternative is:", options: ["Hobbs Modification", "Camp Coventry", "Rosenberg", "Judet"], correct: 0, explanation: "Superior-inferior projection with the patient seated and IR on a stool." },
    { id: 42, q: "The 'Inlet View' of the pelvis requires a tube angulation of:", options: ["40 degrees Caudal", "40 degrees Cephalad", "20 degrees Cephalad", "Perpendicular"], correct: 0, explanation: "40° Caudal angle demonstrates the pelvic ring/inlet." },
    { id: 43, q: "The 'Outlet View' (Taylor Method) requires which angulation for males?", options: ["20-35 degrees Cephalad", "30-45 degrees Cephalad", "40 degrees Caudal", "Perpendicular"], correct: 0, explanation: "Males: 20-35° Cephalad; Females: 30-45° Cephalad." },
    { id: 44, q: "Which baseline is perpendicular to the IR for a SMV (Submentovertex) projection?", options: ["IOML", "OML", "AML", "MML"], correct: 0, explanation: "The Infraorbitomeatal Line (IOML) must be parallel to the IR (CR perpendicular to IOML)." },
    { id: 45, q: "The 'Fuchs Method' is used to visualize the:", options: ["Odontoid Process (Dens)", "Zygomatic Arches", "Temporal Bone", "Mandible"], correct: 0, explanation: "AP projection for the Dens when the Open Mouth view is difficult (tip of chin and mastoid tip vertical)." },
    { id: 46, q: "For the 'Rhese Method' (Parieto-orbital), the midsagittal plane forms what angle with the IR?", options: ["53 degrees", "37 degrees", "45 degrees", "90 degrees"], correct: 0, explanation: "Head rotated 37° towards affected side, so MSP is 53° to IR. Visualizes Optic Foramen." },
    { id: 47, q: "The 'Law Method' for mastoids requires the head to be:", options: ["Lateral, then face rotated 15° toward IR, 15° caudal angle", "True Lateral", "AP Axial", "SMV"], correct: 0, explanation: "Double 15° angle (rotation and tilt/tube angle)." },
    { id: 48, q: "To demonstrate the 'Zygapophyseal joints' of the Lumbar spine, the patient is rotated:", options: ["30-50 degrees", "70 degrees", "20 degrees", "90 degrees"], correct: 0, explanation: "Average 45° (30° for L1-L2, 50° for L5-S1)." },
    { id: 49, q: "The 'Ferguson Method' for Scoliosis is used to distinguish:", options: ["Primary vs Compensatory curves", "Fracture vs Tumor", "Kyphosis vs Lordosis", "Spondylolisthesis"], correct: 0, explanation: "Elevation of the convex side differentiates structural (rigid) from non-structural (compensatory) curves." },
    { id: 50, q: "Which view demonstrates the 'Intercondylar Fossa'?", options: ["Holmblad / Camp Coventry", "Merchant", "Settegast", "Hughston"], correct: 0, explanation: "Tunnel views for the knee notch." },

    // --- RADIOBIOLOGY & PROTECTION (STRICT VALUES) ---
    { id: 51, q: "The NCRP Report 116 annual occupational effective dose limit is:", options: ["50 mSv", "20 mSv", "150 mSv", "5 mSv"], correct: 0, explanation: "NCRP 116 sets the annual limit at 50 mSv (ICRP is 20 mSv avg over 5 yrs)." },
    { id: 52, q: "The equivalent dose limit for the 'Skin, Hands, and Feet' is:", options: ["500 mSv", "150 mSv", "50 mSv", "20 mSv"], correct: 0, explanation: "Extremities can handle higher doses; limit is 500 mSv/year." },
    { id: 53, q: "The 'Genetically Significant Dose' (GSD) for the population is estimated to be:", options: ["0.2 mSv", "1.0 mSv", "5 mSv", "0.01 mSv"], correct: 0, explanation: "Estimated annual GSD from medical imaging is approx 0.2 - 0.3 mSv." },
    { id: 54, q: "Which phase of the cell cycle is the most 'Radio-resistant'?", options: ["Late S-phase", "M-phase", "G1", "G2"], correct: 0, explanation: "Cells are most resistant in late Synthesis (S) phase due to homologous recombination repair mechanisms." },
    { id: 55, q: "The 'Linear Energy Transfer' (LET) of diagnostic X-rays is approximately:", options: ["3 keV/µm", "0.3 keV/µm", "100 keV/µm", "50 keV/µm"], correct: 0, explanation: "Low LET radiation (X-rays/Gamma) is ~3 keV/µm. High LET (Alpha) is >100 keV/µm." },
    { id: 56, q: "Relative Biological Effectiveness (RBE) generally increases as LET:", options: ["Increases", "Decreases", "Remains constant", "Reaches zero"], correct: 0, explanation: "Direct relationship up to a peak (approx 100 keV/µm)." },
    { id: 57, q: "What is the threshold dose for 'Temporary Epilation' (Hair loss)?", options: ["3 Gy (300 rad)", "7 Gy", "1 Gy", "10 Gy"], correct: 0, explanation: "Temporary hair loss begins ~3 Gy. Permanent epilation occurs >7 Gy." },
    { id: 58, q: "The 'OER' (Oxygen Enhancement Ratio) for low-LET radiation is approx:", options: ["2.5 - 3.0", "1.0", "10", "0.5"], correct: 0, explanation: "Oxygenated tissue is 2.5-3x more sensitive to low-LET radiation than hypoxic tissue." },
    { id: 59, q: "Primary protective barriers must contain a minimum lead equivalent of:", options: ["1.6 mm (1/16 inch)", "0.8 mm (1/32 inch)", "0.5 mm", "2.0 mm"], correct: 0, explanation: "Primary barriers (hit by primary beam) require 1/16 inch Pb. Secondary barriers require 1/32 inch." },
    { id: 60, q: "The leakage radiation limit for a diagnostic tube housing is:", options: ["1 mGy/hr at 1 meter", "10 mGy/hr at 1 meter", "0.1 mGy/hr at 1 meter", "5 mGy/hr"], correct: 0, explanation: "100 mR/hr or 1 mGy/hr at 1m." },

    // --- CONTRAST & PHARMACOLOGY ---
    { id: 61, q: "Metformin should be withheld for ___ hours after contrast administration in patients with renal risk.", options: ["48 hours", "24 hours", "12 hours", "No need to withhold"], correct: 0, explanation: "To prevent lactic acidosis if contrast-induced acute kidney injury occurs." },
    { id: 62, q: "Which sequence is best for MRCP (Magnetic Resonance Cholangiopancreatography)?", options: ["Heavily T2-weighted FSE", "T1-weighted GRE", "Diffusion Weighted", "STIR"], correct: 0, explanation: "Fluid (bile) appears very bright on heavy T2; background tissue is suppressed." },
    { id: 63, q: "Gadolinium chelates used in MRI are excreted primarily by:", options: ["Glomerular filtration (Kidneys)", "Biliary system", "Lungs", "Sweat"], correct: 0, explanation: "Renal excretion. Hence risk of NSF in renal failure patients." },
    { id: 64, q: "Nephrogenic Systemic Fibrosis (NSF) is associated with:", options: ["Gadolinium in renal failure", "Iodine in renal failure", "Barium peritonitis", "Air embolism"], correct: 0, explanation: "Rare but serious fibrosis of skin/organs triggered by free Gadolinium in renal failure." },
    { id: 65, q: "The concentration of Barium Sulfate suspension for a 'Double Contrast' stomach study is:", options: ["High density (200-250% w/v)", "Low density (50% w/v)", "Thin barium", "Paste"], correct: 0, explanation: "High density low viscosity barium is needed to coat the mucosa." },

    // --- QUALITY ASSURANCE (QA) ---
    { id: 66, q: "The 'Half Value Layer' (HVL) at 80 kVp must be at least:", options: ["2.3 mm Al", "1.5 mm Al", "3.0 mm Al", "4.0 mm Al"], correct: 0, explanation: "Regulatory standard for beam quality at 80 kVp." },
    { id: 67, q: "Collimator alignment (light field vs X-ray field) must be within:", options: ["± 2% of SID", "± 5% of SID", "± 10% of SID", "± 1% of SID"], correct: 0, explanation: "Standard QA tolerance." },
    { id: 68, q: "Exposure Linearity (between adjacent mA stations) must be within:", options: ["± 10%", "± 5%", "± 2%", "± 20%"], correct: 0, explanation: "mR/mAs should not vary by more than 10% when changing mA stations." },
    { id: 69, q: "The 'Wire Mesh Test' is used to evaluate:", options: ["Screen-Film Contact", "Focal spot size", "kVp accuracy", "Timer accuracy"], correct: 0, explanation: "Blurring of the wire mesh indicates poor contact between the film and screen." },
    { id: 70, q: "A 'Star Pattern' test tool measures:", options: ["Focal Spot Resolution", "Contrast", "Noise", "Dose"], correct: 0, explanation: "It determines the resolving power of the focal spot." },

    // --- ANATOMY & PATHOLOGY SIGNS ---
    { id: 71, q: "'Bamboo Spine' is a classic radiographic sign of:", options: ["Ankylosing Spondylitis", "Diffuse Idiopathic Skeletal Hyperostosis (DISH)", "Osteoporosis", "Multiple Myeloma"], correct: 0, explanation: "Fusion of vertebral bodies by marginal syndesmophytes." },
    { id: 72, q: "The 'Sail Sign' of the elbow indicates:", options: ["Joint Effusion (Occult radial head fracture)", "Dislocation", "Olecranon fracture", "Normal thymus"], correct: 0, explanation: "Displacement of the anterior fat pad (Sail) and visibility of the posterior fat pad." },
    { id: 73, q: "'Cotton Wool' appearance of the skull is characteristic of:", options: ["Paget's Disease (Osteitis Deformans)", "Multiple Myeloma", "Metastasis", "Thalassemia"], correct: 0, explanation: "Mixed lytic and sclerotic phase of Paget's." },
    { id: 74, q: "'Apple Core' lesion in the colon indicates:", options: ["Annular Carcinoma", "Diverticulitis", "Polyp", "Intussusception"], correct: 0, explanation: "Constricting mass typical of colorectal cancer." },
    { id: 75, q: "A 'Sunburst' periosteal reaction is typical of:", options: ["Osteosarcoma", "Ewing's Sarcoma", "Osteomyelitis", "Bone Cyst"], correct: 0, explanation: "Aggressive bone tumor growing perpendicular to the cortex." },
    { id: 76, q: "'Onion Skin' periosteal reaction is seen in:", options: ["Ewing's Sarcoma", "Osteosarcoma", "Chondrosarcoma", "Giant Cell Tumor"], correct: 0, explanation: "Lamellated appearance typical of Ewing's." },
    { id: 77, q: "The 'Silhouette Sign' refers to:", options: ["Loss of a normal anatomical border", "Air bronchogram", "Fluid level", "Calcification"], correct: 0, explanation: "Loss of the heart or diaphragm border due to adjacent consolidation/fluid of similar density." },
    { id: 78, q: "Which fracture involves the base of the 1st Metacarpal?", options: ["Bennett's Fracture", "Boxer's Fracture", "Rolando Fracture", "Colles Fracture"], correct: 0, explanation: "Intra-articular fracture of the thumb base." },
    { id: 79, q: "A 'Hangman's Fracture' is a fracture of the:", options: ["Pars Interarticularis of C2", "Odontoid", "Atlas ring", "C7 spinous process"], correct: 0, explanation: "Traumatic spondylolisthesis of Axis (C2) due to hyperextension." },
    { id: 80, q: "'Rugger Jersey' spine is seen in:", options: ["Renal Osteodystrophy", "Osteopetrosis", "Paget's", "Myeloma"], correct: 0, explanation: "Sclerosis of the superior and inferior endplates of vertebrae." },

    // --- DIGITAL IMAGING DETAILED ---
    { id: 81, q: "The 'Detective Quantum Efficiency' (DQE) of typical digital detectors is approx:", options: ["60-70% (0.6-0.7)", "100%", "20%", "90%"], correct: 0, explanation: "Typical DQE at 0 spatial frequency. Higher than film (~20-30%)." },
    { id: 82, q: "Aliasing artifact occurs when the sampling frequency is:", options: ["Less than 2x the maximum spatial frequency (Nyquist)", "More than 2x", "Equal to 2x", "Unrelated"], correct: 0, explanation: "Violation of the Nyquist theorem causes high frequency signals to appear as low frequency (Moiré)." },
    { id: 83, q: "In Histogram Analysis, the 'S-value' (Fuji) or 'EI' (Kodak) represents:", options: ["Exposure Index (Dose to detector)", "Patient dose", "Tube output", "Brightness"], correct: 0, explanation: "Indirect measure of the radiation reaching the plate." },
    { id: 84, q: "Bit Depth of 12 bits allows for how many shades of gray?", options: ["4096", "256", "1024", "16384"], correct: 0, explanation: "2^12 = 4096." },
    { id: 85, q: "Which compression is 'Lossless'?", options: ["Run-length encoding (RLE)", "JPEG (High)", "Wavelet (High ratio)", "Fractal"], correct: 0, explanation: "Lossless compression (2:1 or 3:1) preserves original data exactly." },

    // --- MISCELLANEOUS HARD ---
    { id: 86, q: "The 'Air Kerma' (Gy_a) measures:", options: ["Kinetic energy released per unit mass of air", "Absorbed dose in tissue", "Effective dose", "Radioactivity"], correct: 0, explanation: "Standard unit for radiation intensity in air." },
    { id: 87, q: "For a 'Lateral Decubitus' Chest X-ray to demonstrate fluid, the patient must lie:", options: ["On the affected side", "On the unaffected side", "Supine", "Prone"], correct: 0, explanation: "Fluid sinks. To see effusion, affected side down. To see pneumothorax, affected side up." },
    { id: 88, q: "The 'Angle of Wiskott' is related to:", options: ["Calcaneal fracture (Böhler's angle)", "Acetabular angle", "Scapular angle", "Kyphosis"], correct: 0, explanation: "Wait, Böhler's angle is standard. Wiskott is less common/distractor. Sticking to Böhler's: 20-40 degrees." },
    { id: 89, q: "An 'Avulsion fracture' of the tibial tuberosity in adolescents is known as:", options: ["Osgood-Schlatter Disease", "Salter-Harris", "Jones fracture", "Segond fracture"], correct: 0, explanation: "Traction apophysitis." },
    { id: 90, q: "Which contrast agent has the highest risk of adverse reaction?", options: ["High Osmolar Ionic", "Low Osmolar Non-ionic", "Iso-osmolar", "Barium"], correct: 0, explanation: "HOCM (Ionic) dissociates into ions, increasing osmolality and reaction risk." },
    { id: 91, q: "The 'Sensitivity Speck' in a silver halide crystal is usually composed of:", options: ["Silver Sulfide", "Gold", "Lead", "Iodine"], correct: 0, explanation: "Impurity center where the latent image forms." },
    { id: 92, q: "In USG, acoustic shadowing is caused by:", options: ["Highly attenuating structures (Stones/Bone)", "Fluid", "Air", "Blood"], correct: 0, explanation: "Total reflection/absorption of sound leaves a shadow behind the object." },
    { id: 93, q: "Reverberation artifact in USG appears as:", options: ["Multiple equally spaced parallel lines", "Black shadow", "Bright enhancement", "Mirror image"], correct: 0, explanation: "Bouncing of sound between two reflective surfaces." },
    { id: 94, q: "The 'Piezoelectric effect' converts:", options: ["Electrical energy to Mechanical (Sound) and vice versa", "Heat to Sound", "Light to Sound", "X-ray to Light"], correct: 0, explanation: "Principle of the US transducer." },
    { id: 95, q: "Which USG probe frequency provides the best penetration for abdominal scanning?", options: ["2.5 - 3.5 MHz", "7 - 10 MHz", "15 MHz", "20 MHz"], correct: 0, explanation: "Low frequency = better penetration, lower resolution." },
    { id: 96, q: "The 'Flow Void' phenomenon in MRI causes flowing blood to appear:", options: ["Black (Signal loss)", "Bright", "Grey", "Green"], correct: 0, explanation: "In Spin Echo, blood moves out of the slice before the refocusing pulse, giving no signal." },
    { id: 97, q: "Typically, the 'Delay' time for an arterial phase CT liver is:", options: ["25-35 seconds", "60-70 seconds", "10 seconds", "100 seconds"], correct: 0, explanation: "Late arterial phase captures hypervascular lesions." },
    { id: 98, q: "Standard 'Portal Venous' phase delay is:", options: ["60-70 seconds", "30 seconds", "120 seconds", "5 minutes"], correct: 0, explanation: "Peak liver parenchymal enhancement." },
    { id: 99, q: "Which dosimeter is most sensitive to environmental heat and humidity?", options: ["Film Badge", "TLD", "OSL", "Pocket Ion Chamber"], correct: 0, explanation: "Film is sensitive to heat/humidity causing fogging." },
    { id: 100, q: "The 'Target angle' of a typical diagnostic anode is:", options: ["7 to 17 degrees", "45 degrees", "1 degree", "90 degrees"], correct: 0, explanation: "12 degrees is a common average to balance heat loading and field coverage." }
];
/* -------------------------------------------------------------- */

const STORAGE_KEY = 'aiims_paper5_answers_v2';
const SUBMITTED_KEY = 'aiims_paper5_submitted_v2';

let userAnswers = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
let submitted = localStorage.getItem(SUBMITTED_KEY) === 'true' ? true : false;
let reviewMode = false;

const quizEl = document.getElementById('quiz');
const progressEl = document.getElementById('progress');
const submitBtn = document.getElementById('submitBtn');
const submitModal = document.getElementById('submitModal');
const confirmInput = document.getElementById('confirmInput');
const confirmSubmitBtn = document.getElementById('confirmSubmitBtn');
const resultModal = document.getElementById('resultModal');

function safeSetAnswers() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(userAnswers));
}

function renderQuiz(){
  quizEl.innerHTML = '';
  questionsDB.forEach((q, i) => {
    const card = document.createElement('div');
    card.className = 'question-card';

    const qnum = i + 1;
    const qtext = document.createElement('div');
    qtext.className = 'question-text';
    qtext.textContent = `Q${qnum}. ${q.q}`;
    card.appendChild(qtext);

    const optionsDiv = document.createElement('div');
    optionsDiv.className = 'options-grid';

    const ua = userAnswers[q.id] !== undefined ? userAnswers[q.id] : null;

    q.options.forEach((opt, idx) => {
      const label = document.createElement('label');
      label.className = 'option-label';

      // Styling for review mode
      if (reviewMode) {
        if (idx === q.correct) label.classList.add('correct');
        if (ua === idx && ua !== q.correct) label.classList.add('wrong');
      } else {
        if (ua === idx) label.classList.add('selected');
      }

      // radio (disabled when submitted)
      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = `q_${q.id}`;
      radio.checked = ua === idx;
      radio.disabled = submitted; // lock after final submission
      // we don't rely on the radio click; label click handles selection

      const span = document.createElement('span');
      span.textContent = opt;

      label.appendChild(radio);
      label.appendChild(span);

      if (!submitted) {
        label.addEventListener('click', () => {
          userAnswers[q.id] = idx;
          safeSetAnswers();
          // enable submit button if at least one answer or allow manual opening
          evaluateSubmitEnable();
          renderQuiz();
        });
      }

      optionsDiv.appendChild(label);
    });

    card.appendChild(optionsDiv);

    // show explanation only in review mode
    if (reviewMode) {
      const expl = document.createElement('div');
      expl.className = 'explanation';
      expl.innerHTML = `<strong>Explanation:</strong> ${q.explanation}`;
      card.appendChild(expl);
    }

    quizEl.appendChild(card);
  });

  progressEl.innerText = `${Object.keys(userAnswers).length} / ${questionsDB.length}`;
}

// ----------------- Submit safety logic -----------------
function evaluateSubmitEnable(){
  // enable submit if user has answered at least one question (otherwise disabled)
  const answeredCount = Object.keys(userAnswers).length;
  // allow enabling even if zero answered only if user explicitly opens modal (we keep disabled by default)
  submitBtn.disabled = false ? false : (answeredCount === 0 ? true : false);
  // In short: enabled only when answeredCount > 0
  submitBtn.disabled = (answeredCount === 0);
}

submitBtn.addEventListener('click', () => {
  // open modal to require typing SUBMIT
  openSubmitModal();
});

function openSubmitModal(){
  confirmInput.value = '';
  confirmSubmitBtn.disabled = true;
  submitModal.style.display = 'flex';
  confirmInput.focus();
}

function closeSubmitModal(){
  submitModal.style.display = 'none';
}

// Enable confirm button only when input === 'SUBMIT'
confirmInput.addEventListener('input', () => {
  confirmSubmitBtn.disabled = confirmInput.value !== 'SUBMIT';
});

function confirmSubmit(){
  // final step: commit submission
  closeSubmitModal();
  submitExamFinal();
}

function submitExamFinal(){
  // set submitted true and persist it (so page reload doesn't re-submit automatically)
  submitted = true;
  localStorage.setItem(SUBMITTED_KEY, 'true');

  // compute results
  let correct = 0, wrong = 0, skipped = 0;
  questionsDB.forEach(q => {
    const a = userAnswers[q.id];
    if (a === undefined || a === null) skipped++;
    else if (a === q.correct) correct++;
    else wrong++;
  });

  const score = correct * 4 - wrong * 1;
  document.getElementById('scoreVal').innerText = score;
  document.getElementById('corr').innerText = correct;
  document.getElementById('wrong').innerText = wrong;
  document.getElementById('skipped').innerText = skipped;
  const acc = (correct + wrong) === 0 ? 0 : Math.round((correct / (correct + wrong)) * 100);
  document.getElementById('acc').innerText = acc;

  // show result modal
  resultModal.style.display = 'flex';
  // re-render to lock radios & reflect styles
  renderQuiz();
}

// close result modal
function closeResultModal(){
  resultModal.style.display = 'none';
}

// ----------------- Review -----------------
function startReview(){
  resultModal.style.display = 'none';
  reviewMode = true;
  // keep submitted true so options remain disabled
  renderQuiz();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ----------------- Reset -----------------
function resetExam(){
  if (!confirm('Clear saved answers and reload the paper?')) return;
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem(SUBMITTED_KEY);
  userAnswers = {};
  submitted = false;
  reviewMode = false;
  renderQuiz();
  evaluateSubmitEnable();
  resultModal.style.display = 'none';
}

// ----------------- Initialization -----------------
(function init(){
  // Defensive: ensure no automatic submission happens on load.
  // If previously submitted flag is true, we will show result modal but NOT auto-run submitExamFinal again.
  // If you prefer not to persist submitted state across reloads, remove SUBMITTED_KEY usage above.
  renderQuiz();
  evaluateSubmitEnable();

  // if previously submitted, show result summary but keep review closed
  if (localStorage.getItem(SUBMITTED_KEY) === 'true') {
    // compute results so user sees them immediately (but don't call submitExamFinal which resets modal)
    let correct = 0, wrong = 0, skipped = 0;
    questionsDB.forEach(q => {
      const a = userAnswers[q.id];
      if (a === undefined || a === null) skipped++;
      else if (a === q.correct) correct++;
      else wrong++;
    });
    const score = correct * 4 - wrong * 1;
    document.getElementById('scoreVal').innerText = score;
    document.getElementById('corr').innerText = correct;
    document.getElementById('wrong').innerText = wrong;
    document.getElementById('skipped').innerText = skipped;
    const acc = (correct + wrong) === 0 ? 0 : Math.round((correct / (correct + wrong)) * 100);
    document.getElementById('acc').innerText = acc;
    // Important: do NOT auto-open the submit modal; show result only on user action
    // If you want to automatically show the result modal on load (because previously submitted), uncomment:
    // resultModal.style.display = 'flex';
  }
})();
</script>
</body>
</html>
