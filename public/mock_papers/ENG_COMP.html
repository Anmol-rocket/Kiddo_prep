
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIIMS CRE Radiographer CBT Mock</title>
    <style>
        :root {
            --header-bg: #3f51b5;
            --header-text: #fff;
            --panel-bg: #f5f5f5;
            --pallet-answered: #4caf50;
            --pallet-not-answered: #f44336;
            --pallet-review: #9c27b0;
            --pallet-not-visited: #e0e0e0;
            --text-color: #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; }
        body { height: 100vh; display: flex; flex-direction: column; overflow: hidden; background: #fff; }

        /* --- Header --- */
        header {
            background: var(--header-bg); color: var(--header-text);
            padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;
            height: 60px; flex-shrink: 0;
        }
        .timer { font-size: 1.2rem; font-weight: bold; background: #fff; color: #333; padding: 5px 15px; border-radius: 4px; }

        /* --- Main Layout --- */
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* Left: Question Area */
        .question-area { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; }
        .q-header { display: flex; justify-content: space-between; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 15px; }
        .q-text { font-size: 1.1rem; margin-bottom: 20px; line-height: 1.5; }
        
        .options-container { display: flex; flex-direction: column; gap: 10px; }
        .option-label { 
            display: flex; align-items: center; padding: 10px; border: 1px solid #ccc; border-radius: 5px; cursor: pointer; transition: 0.2s; 
        }
        .option-label:hover { background: #f0f8ff; }
        .option-label input { margin-right: 15px; transform: scale(1.2); }

        /* Right: Sidebar (Palette) */
        .sidebar {
            width: 320px; background: var(--panel-bg); border-left: 1px solid #ccc;
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .user-info { padding: 10px; background: #e8eaf6; border-bottom: 1px solid #ccc; display: flex; align-items: center; gap: 10px; }
        .user-img { width: 40px; height: 40px; background: #bbb; border-radius: 50%; }
        
        .palette-legend { padding: 10px; font-size: 0.8rem; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; background: #fff; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }

        .question-grid { 
            padding: 10px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            overflow-y: auto; flex: 1; align-content: start;
        }
        .q-btn {
            height: 35px; width: 35px; border: 1px solid #ccc; background: #fff; 
            border-radius: 4px; cursor: pointer; font-size: 0.9rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
        }
        
        /* Button States */
        .q-btn.answered { background: var(--pallet-answered); color: white; border-color: var(--pallet-answered); clip-path: polygon(0% 0%, 100% 0%, 100% 75%, 50% 100%, 0% 75%);  }
        .q-btn.not-answered { background: var(--pallet-not-answered); color: white; border-color: var(--pallet-not-answered); clip-path: polygon(0% 0%, 100% 0%, 100% 75%, 50% 100%, 0% 75%); }
        .q-btn.review { background: var(--pallet-review); color: white; border-radius: 50%; }
        .q-btn.current { border: 2px solid blue; box-shadow: 0 0 5px blue; }
        .q-btn.locked { opacity: 0.5; cursor: not-allowed; background: #555 !important; color: #fff; }

        /* Footer Controls */
        .footer-controls {
            height: 60px; background: #fff; border-top: 1px solid #ccc;
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        }
        .btn { padding: 8px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
        .btn-primary { background: #2196f3; color: white; }
        .btn-success { background: #4caf50; color: white; }
        .btn-warn { background: #ff9800; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Mobile Adjustments */
        .mobile-toggle { display: none; background: none; border: none; color: white; font-size: 1.5rem; }
        
        @media (max-width: 768px) {
            .mobile-toggle { display: block; }
            .sidebar { 
                position: absolute; right: 0; top: 60px; bottom: 60px; z-index: 100;
                transform: translateX(100%); transition: transform 0.3s; width: 85%;
            }
            .sidebar.active { transform: translateX(0); }
            .question-grid { grid-template-columns: repeat(6, 1fr); }
            .footer-controls { flex-wrap: wrap; gap: 5px; height: auto; padding: 10px; }
            .btn { flex: 1; padding: 8px; font-size: 0.8rem; }
        }

        /* Overlay */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .hidden { display: none !important; }

        /* Review Mode */
        .review-panel { display: none; padding: 20px; height: 100%; overflow-y: auto; }
        .review-item { margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
        .correct-ans { color: green; font-weight: bold; }
        .wrong-ans { color: red; font-weight: bold; }
        .explanation { background: #fff3cd; padding: 10px; margin-top: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="landingPage" class="overlay">
        <h1>AIIMS CRE Radiographer CBT Mock</h1>
        <div style="width: 80%; max-width: 600px; text-align: left; margin: 20px 0;">
            <h3>Instructions:</h3>
            <ul>
                <li><strong>Total Questions:</strong> 100 (20 Non-Core, 80 Core)</li>
                <li><strong>Time:</strong> 90 Minutes</li>
                <li><strong>Marking:</strong> +4 Correct, -1 Incorrect, 0 Unattempted.</li>
                <li><strong>Constraint:</strong> Questions appear in sets of 20. Once you proceed to the next set (e.g., Q21), the previous set (Q1-20) is locked.</li>
            </ul>
        </div>
        <button class="btn btn-success" style="font-size: 1.2rem;" onclick="startExam()">START EXAM</button>
    </div>

    <header id="examHeader" class="hidden">
        <div style="display:flex; align-items:center; gap:10px;">
            <h3>AIIMS CRE</h3>
        </div>
        <div class="timer" id="timerDisplay">90:00</div>
        <button class="mobile-toggle" onclick="toggleSidebar()">â˜°</button>
    </header>

    <div class="main-container hidden" id="examBody">
        <div class="question-area">
            <div class="q-header">
                <span id="qNumDisplay">Question No. 1</span>
                <span style="color: #666;">Marks: +4, -1</span>
            </div>
            <div id="questionText" class="q-text">Loading question...</div>
            <div id="optionsBox" class="options-container">
                </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="user-info">
                <div class="user-img"></div>
                <div>
                    <strong>Candidate Name</strong><br>
                    <small>Radiographer</small>
                </div>
            </div>
            <div class="palette-legend">
                <div class="legend-item"><span class="dot" style="background:var(--pallet-answered)"></span> Answered</div>
                <div class="legend-item"><span class="dot" style="background:var(--pallet-not-answered)"></span> Not Ans</div>
                <div class="legend-item"><span class="dot" style="background:var(--pallet-review)"></span> Review</div>
                <div class="legend-item"><span class="dot" style="background:#555"></span> Locked</div>
            </div>
            <div style="padding:5px; background:#ddd; font-weight:bold; text-align:center;">Question Palette</div>
            <div class="question-grid" id="questionPalette">
                </div>
            <div style="padding:10px; margin-top:auto;">
                <button class="btn btn-primary" style="width:100%" onclick="submitExam()">SUBMIT PAPER</button>
            </div>
        </div>
    </div>

    <div class="footer-controls hidden" id="examFooter">
        <div style="display:flex; gap:10px;">
            <button class="btn btn-danger" onclick="clearResponse()">Clear Response</button>
            <button class="btn btn-warn" onclick="markForReview()">Mark for Review</button>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn" onclick="prevQuestion()" id="btnPrev">Previous</button>
            <button class="btn btn-success" onclick="saveAndNext()">Save & Next</button>
        </div>
    </div>

    <div id="resultPage" class="overlay hidden" style="display:block; overflow-y:auto; justify-content:start; padding-top:40px;">
        <h2>Exam Summary</h2>
        <div id="scoreCard" style="margin: 20px; padding: 20px; border: 1px solid #ccc; text-align: center;">
            </div>
        <div style="display:flex; gap:20px; margin-bottom:20px;">
            <button class="btn btn-primary" onclick="showDetailedReview()">Review Questions</button>
            <button class="btn btn-danger" onclick="resetExam()">Exit / Restart</button>
        </div>
        <div id="detailedReview" class="review-panel" style="width: 90%; max-width: 800px;"></div>
    </div>

    <script type="text/javascript" charset="utf-8">
      // --- 1. Data & Configuration ---
    const TOTAL_QUESTIONS = 100;
    const SET_SIZE = 20; 
    const EXAM_DURATION = 90 * 60; // 90 Minutes

    let questions = [];

   function generateQuestions() {
        const createQ = (id, type, text, opts, ans, exp) => ({ id, type, text, opts, ans, exp });
        questions = []; // Reset array

        // --- PART 1: COMPUTER KNOWLEDGE (Questions 1-50) ---
        // Topics: MS Office, Hardware, Internet, Shortcuts, Security

        const computerData = [
            // MS Word & Office
            ["Which function key is used for 'Save As' in MS Word?", ["F5", "F12", "F10", "F1"], 1, "F12 opens the Save As dialog."],
            ["What is the shortcut key to 'Center Align' text?", ["Ctrl + C", "Ctrl + E", "Ctrl + R", "Ctrl + M"], 1, "Ctrl + E is for Center Alignment."],
            ["In MS Excel, a formula always begins with which symbol?", ["#", "@", "=", "+"], 2, "Formulas start with '='."],
            ["Which PowerPoint view is used to rearrange slides easily?", ["Slide Sorter", "Notes Page", "Normal", "Reading View"], 0, "Slide Sorter view."],
            ["'Portrait' and 'Landscape' are examples of:", ["Paper Size", "Page Orientation", "Page Layout", "Margins"], 1, "Page Orientation."],
            ["What is the shortcut to 'Find and Replace'?", ["Ctrl + F", "Ctrl + H", "Ctrl + R", "Alt + F"], 1, "Ctrl + H opens the Find and Replace dialog."],
            ["Which extension represents a PowerPoint presentation?", [".ppt", ".xls", ".doc", ".txt"], 0, ".ppt or .pptx."],
            ["To select the entire document in MS Word, press:", ["Ctrl + A", "Ctrl + S", "Alt + A", "Shift + A"], 0, "Ctrl + A."],
            ["The intersection of a row and a column in Excel is called a:", ["Data", "Field", "Cell", "Grid"], 2, "Cell."],
            ["Which of these is NOT a font style?", ["Bold", "Italics", "Regular", "Superscript"], 3, "Superscript is a text effect, not a base font style."],

            // Hardware & Software Basics
            ["The 'Brain' of the computer is:", ["Monitor", "ALU", "CPU", "Hard Disk"], 2, "Central Processing Unit (CPU)."],
            ["1 Gigabyte (GB) equals:", ["1024 KB", "1024 MB", "1024 TB", "1000 MB"], 1, "1024 Megabytes."],
            ["Which of the following is an Output device?", ["Scanner", "Mouse", "Printer", "Keyboard"], 2, "Printer."],
            ["RAM stands for:", ["Read Access Memory", "Random Access Memory", "Read Automated Memory", "Random Automated Memory"], 1, "Random Access Memory."],
            ["Which memory is non-volatile (permanent)?", ["RAM", "Cache", "ROM", "Register"], 2, "Read Only Memory (ROM)."],
            ["The smallest unit of data in a computer is:", ["Bit", "Byte", "Nibble", "Kilo"], 0, "Bit (0 or 1)."],
            ["'GUI' stands for:", ["Graphical User Interface", "Global User Interface", "General User Interface", "Graphical Utility Item"], 0, "Graphical User Interface."],
            ["Which of these is system software?", ["MS Word", "Photoshop", "Windows 10", "Chrome"], 2, "Windows 10 is an Operating System (System Software)."],
            ["USB stands for:", ["Universal Serial Bus", "Unique Serial Bus", "Universal Service Bus", "United Serial Bus"], 0, "Universal Serial Bus."],
            ["The resolution of a printer is measured in:", ["DPI", "PPM", "Hz", "MB"], 0, "Dots Per Inch (DPI)."],

            // Internet & Networks
            ["'HTML' stands for:", ["Hyper Text Markup Language", "High Text Markup Language", "Hyper Text Make Language", "Hyperlink Text Mark Language"], 0, "Hyper Text Markup Language."],
            ["Which protocol is used for browsing websites?", ["SMTP", "FTP", "HTTP", "TCP"], 2, "Hypertext Transfer Protocol."],
            ["A website's address is known as:", ["URL", "ISP", "HTML", "USB"], 0, "Uniform Resource Locator (URL)."],
            ["'Spam' refers to:", ["Deleted emails", "Draft emails", "Unsolicited junk emails", "Sent emails"], 2, "Junk/Unwanted emails."],
            ["Which device connects a computer to the internet via telephone line?", ["Router", "Modem", "Switch", "Hub"], 1, "Modulator-Demodulator (Modem)."],
            ["'Wifi' stands for:", ["Wireless Fidelity", "Wireless Fields", "Wide Fidelity", "Wired Fidelity"], 0, "Wireless Fidelity."],
            ["Which of these is a Web Browser?", ["Google", "Edge", "Windows", "Yahoo"], 1, "Microsoft Edge. (Google and Yahoo are search engines)."],
            ["Storing data on remote servers accessed via the internet is called:", ["Cloud Computing", "Local Computing", "Grid Computing", "Soft Computing"], 0, "Cloud Computing."],
            ["'Phishing' is:", ["Checking network speed", "A cyber attack to steal data", "Installing software", "Deleting files"], 1, "Fraudulent attempt to steal sensitive info."],
            ["Which software protects a PC from viruses?", ["Firewall", "Antivirus", "Firmware", "Shareware"], 1, "Antivirus software."],

            // Keyboard Shortcuts & Misc
            ["Shortcut to 'Undo' last action:", ["Ctrl + Z", "Ctrl + Y", "Ctrl + U", "Ctrl + X"], 0, "Ctrl + Z."],
            ["Shortcut to 'Redo' last action:", ["Ctrl + Z", "Ctrl + Y", "Ctrl + R", "Ctrl + D"], 1, "Ctrl + Y."],
            ["Shortcut to 'Cut' selected text:", ["Ctrl + C", "Ctrl + X", "Ctrl + V", "Ctrl + K"], 1, "Ctrl + X."],
            ["Shortcut to 'Paste' text:", ["Ctrl + P", "Ctrl + V", "Ctrl + S", "Shift + P"], 1, "Ctrl + V."],
            ["Which key deletes the character to the LEFT of the cursor?", ["Delete", "Backspace", "Space", "Esc"], 1, "Backspace. (Delete removes character to the Right)."],
            ["To permanently delete a file (bypass Recycle Bin):", ["Shift + Delete", "Ctrl + Delete", "Alt + Delete", "Del"], 0, "Shift + Delete."],
            ["'Refresh' shortcut:", ["F2", "F5", "F8", "F1"], 1, "F5."],
            ["Alt + Tab is used to:", ["Close window", "Switch between open apps", "Open Start menu", "Shutdown"], 1, "Switch windows."],
            ["Ctrl + Esc is used to:", ["Open Start Menu", "Open Task Manager", "Minimize", "Close"], 0, "Open Start Menu."],
            ["Which file format represents an image?", [".mp3", ".jpg", ".doc", ".exe"], 1, ".jpg (JPEG)."],
            
            // Advanced / Recent
            ["'PDF' stands for:", ["Portable Document Format", "Public Data File", "Print Document File", "Private Data Format"], 0, "Portable Document Format."],
            ["Who is known as the father of the computer?", ["Alan Turing", "Charles Babbage", "Bill Gates", "Steve Jobs"], 1, "Charles Babbage."],
            ["'IP Address' stands for:", ["Internet Provider", "Internet Protocol", "Internal Protocol", "Instant Protocol"], 1, "Internet Protocol."],
            ["Which is a valid email address?", ["user.gmail.com", "user@gmail.com", "user@gmail", "@user.gmail"], 1, "user@gmail.com"],
            ["'Binary' language consists of:", ["0 and 1", "0 to 9", "A to Z", "Symbols"], 0, "0 and 1."],
            ["What is 'Android'?", ["Input device", "Operating System", "Application Software", "Hardware"], 1, "Mobile Operating System."],
            ["'Bug' in computer terminology means:", ["Virus", "Error in program", "Spyware", "Hardware failure"], 1, "Software error."],
            ["'Cookies' in browsing are:", ["Virus files", "Small text files storing user data", "Images", "Plugins"], 1, "Store user preferences/session data."],
            ["Ctrl + B makes text:", ["Big", "Bold", "Blue", "Break"], 1, "Bold."],
            ["Ctrl + U makes text:", ["Underline", "Undo", "Upper case", "Unlock"], 0, "Underline."]
        ];
        computerData.forEach((d, i) => questions.push(createQ(i + 1, "Computer", d[0], d[1], d[2], d[3])));

        // --- PART 2: ENGLISH LANGUAGE (Questions 51-100) ---
        // Topics: Grammar, Vocabulary, Idioms, Comprehension basics

        const englishData = [
            // Synonyms & Antonyms
            ["Synonym of 'ABANDON':", ["Keep", "Cherish", "Forsake", "Enlarge"], 2, "Forsake means to leave or abandon."],
            ["Synonym of 'CANDID':", ["Dishonest", "Frank", "Secretive", "Rude"], 1, "Frank or honest."],
            ["Synonym of 'LETHARGY':", ["Activity", "Laziness", "Energy", "Speed"], 1, "Laziness or lack of energy."],
            ["Antonym of 'OPTIMISTIC':", ["Happy", "Pessimistic", "Hopeful", "Bright"], 1, "Pessimistic."],
            ["Antonym of 'ARTIFICIAL':", ["Red", "Natural", "Truthful", "Solid"], 1, "Natural."],
            ["Antonym of 'EXPAND':", ["Congest", "Conclude", "Convert", "Contract"], 3, "Contract (shrink)."],
            ["Synonym of 'BENEVOLENT':", ["Cruel", "Kind", "Rich", "Poor"], 1, "Kind or charitable."],
            ["Antonym of 'TRANSPARENT':", ["Clear", "Opaque", "Glassy", "Clean"], 1, "Opaque (cannot see through)."],
            ["Synonym of 'DILIGENT':", ["Lazy", "Hardworking", "Intelligent", "Slow"], 1, "Hardworking."],
            ["Antonym of 'ANCIENT':", ["Old", "Modern", "Historic", "Past"], 1, "Modern."],

            // One Word Substitution
            ["A person who looks at the bright side of things:", ["Pessimist", "Optimist", "Atheist", "Theist"], 1, "Optimist."],
            ["Life history of a person written by himself:", ["Biography", "Autobiography", "History", "Novel"], 1, "Autobiography."],
            ["A cure for all diseases:", ["Antidote", "Panacea", "Antibiotic", "Vaccine"], 1, "Panacea."],
            ["One who cannot read or write:", ["Illiterate", "Literate", "Scholar", "Blind"], 0, "Illiterate."],
            ["A place where birds are kept:", ["Aquarium", "Aviary", "Apiary", "Zoo"], 1, "Aviary. (Apiary is for bees)."],
            ["One who knows everything:", ["Omnipotent", "Omniscient", "Omnipresent", "Optimist"], 1, "Omniscient."],
            ["A government by the people:", ["Monarchy", "Democracy", "Autocracy", "Plutocracy"], 1, "Democracy."],
            ["A sound that cannot be heard:", ["Audible", "Inaudible", "Invincible", "Invisible"], 1, "Inaudible."],
            ["Killing of one's own self:", ["Homicide", "Suicide", "Patricide", "Regicide"], 1, "Suicide."],
            ["A handwriting that is difficult to read:", ["Illegible", "Legible", "Eligible", "Ineligible"], 0, "Illegible."],

            // Idioms & Phrases
            ["'To break the ice':", ["To start a fight", "To start a conversation", "To cool down", "To break something"], 1, "To relieve tension/start talking."],
            ["'A piece of cake':", ["Something very tasty", "Something very easy", "Something difficult", "A part of dessert"], 1, "Very easy task."],
            ["'Once in a blue moon':", ["Very rarely", "Often", "Every month", "Never"], 0, "Very rarely."],
            ["'To burn the midnight oil':", ["To waste oil", "To work late into the night", "To cook", "To sleep late"], 1, "Work hard/study late."],
            ["'Apple of one's eye':", ["A tasty fruit", "The person someone loves most", "An enemy", "A doctor"], 1, "Someone very precious."],
            ["'To hit the nail on the head':", ["To injure someone", "To do/say exactly the right thing", "To build", "To fail"], 1, "To be exactly correct."],
            ["'Let the cat out of the bag':", ["To free a pet", "To reveal a secret", "To make a mistake", "To travel"], 1, "Reveal a secret accidentally."],
            ["'At the eleventh hour':", ["At 11:00 PM", "At the very last moment", "Too early", "In the morning"], 1, "Last moment."],
            ["'To cry over spilt milk':", ["To cry in kitchen", "To regret something that cannot be undone", "To be happy", "To clean up"], 1, "Regret past actions."],
            ["'Through thick and thin':", ["Being fat and thin", "Under all circumstances", "Through a forest", "Sometimes"], 1, "Support through good and bad times."],

            // Grammar (Prepositions, Articles, Tenses)
            ["He is afraid ___ dogs.", ["with", "by", "of", "from"], 2, "Afraid of."],
            ["She is good ___ Mathematics.", ["in", "at", "on", "with"], 1, "Good at."],
            ["I prefer tea ___ coffee.", ["than", "to", "over", "from"], 1, "Prefer tea TO coffee."],
            ["He died ___ malaria.", ["of", "from", "by", "with"], 0, "Died OF a disease."],
            ["Please listen ___ me.", ["at", "to", "on", "with"], 1, "Listen to."],
            ["He has been sleeping ___ 2 hours.", ["since", "for", "from", "in"], 1, "For (duration). 'Since' is for point of time."],
            ["___ Sun rises in the East.", ["A", "An", "The", "No article"], 2, "The Sun (Unique object)."],
            ["He is ___ honest man.", ["a", "an", "the", "none"], 1, "An honest (Silent H)."],
            ["They ___ playing cricket yesterday.", ["are", "were", "was", "have"], 1, "Were (Past plural)."],
            ["If I ___ a bird, I would fly.", ["am", "was", "were", "be"], 2, "If I WERE (Subjunctive mood/Imaginary)."],

            // Spelling & Sentence Correction
            ["Choose the correctly spelled word:", ["Receive", "Recieve", "Riceive", "Receve"], 0, "Receive (I before E except after C)."],
            ["Choose the correctly spelled word:", ["Grammer", "Grammar", "Gramar", "Gramer"], 1, "Grammar."],
            ["Choose the correctly spelled word:", ["Colonel", "Colonal", "Curnel", "Colnel"], 0, "Colonel."],
            ["Choose the correctly spelled word:", ["Vacuum", "Vaccum", "Vacume", "Vecuum"], 0, "Vacuum (Double U)."],
            ["Choose the correctly spelled word:", ["Embarrass", "Embarass", "Emberass", "Embaras"], 0, "Embarrass (Double R, Double S)."],
            ["Identify the error: 'She don't like apples.'", ["She", "don't", "like", "apples"], 1, "Should be 'doesn't'."],
            ["Identify the error: 'I am going to home.'", ["I", "am going", "to", "home"], 2, "Should be 'going home' (No 'to' before home usually)."],
            ["Past participle of 'Go':", ["Went", "Gone", "Going", "Goes"], 1, "Go - Went - Gone."],
            ["Plural of 'Child':", ["Childs", "Children", "Childrens", "Childes"], 1, "Children."],
            ["Feminine gender of 'Nephew':", ["Niece", "Sister", "Mother", "Aunt"], 0, "Niece."]
        ];
        englishData.forEach((d, i) => questions.push(createQ(51 + i, "English", d[0], d[1], d[2], d[3])));
    }
    
    // Call the function to populate the array immediately
    generateQuestions();
    
    // --- 2. State Management ---
    let state = {
        currentQ: 0,
        answers: new Array(TOTAL_QUESTIONS).fill(null),
        status: new Array(TOTAL_QUESTIONS).fill('not-visited'),
        timeLeft: EXAM_DURATION,
        isFinished: false,
        maxSetReached: 0
    };

    // --- 3. DOM Elements (Ensure these match your HTML IDs) ---
    const els = {
        landing: document.getElementById('landingPage'),
        header: document.getElementById('examHeader'),
        body: document.getElementById('examBody'),
        footer: document.getElementById('examFooter'),
        result: document.getElementById('resultPage'),
        qText: document.getElementById('questionText'),
        optsBox: document.getElementById('optionsBox'),
        qNum: document.getElementById('qNumDisplay'),
        palette: document.getElementById('questionPalette'),
        timer: document.getElementById('timerDisplay'),
        btnPrev: document.getElementById('btnPrev'),
        sidebar: document.getElementById('sidebar')
    };

    // --- 4. Logic Functions ---

    function init() {
        const savedState = localStorage.getItem('aiims_cbt_state');
        if (savedState) {
            try {
                const parsed = JSON.parse(savedState);
                // Validate if saved state matches current question count
                if(parsed.answers.length === TOTAL_QUESTIONS) {
                    state = parsed;
                    if (state.isFinished) {
                        showResult();
                        return;
                    }
                    renderExamInterface();
                    startTimer();
                } else {
                    // Reset if question count changed
                    localStorage.removeItem('aiims_cbt_state');
                    els.landing.classList.remove('hidden');
                }
            } catch(e) {
                 els.landing.classList.remove('hidden');
            }
        } else {
            els.landing.classList.remove('hidden');
            els.result.classList.add('hidden');
        }
    }

    function startExam() {
        els.landing.classList.add('hidden');
        renderExamInterface();
        startTimer();
        updatePersistence();
    }

    function renderExamInterface() {
        els.header.classList.remove('hidden');
        els.body.classList.remove('hidden');
        els.footer.classList.remove('hidden');
        renderPalette();
        loadQuestion(state.currentQ);
    }

    function loadQuestion(index) {
        state.currentQ = index;
        if(state.status[index] === 'not-visited') {
            state.status[index] = 'not-answered';
        }
        
        // Update UI
        els.qNum.innerText = `Question No. ${index + 1} (${questions[index].type})`;
        els.qText.innerText = questions[index].text;
        
        els.optsBox.innerHTML = '';
        questions[index].opts.forEach((opt, i) => {
            const isChecked = state.answers[index] === i ? 'checked' : '';
            els.optsBox.innerHTML += `
                <label class="option-label">
                    <input type="radio" name="opt" value="${i}" ${isChecked} onchange="selectOption(${i})">
                    ${opt}
                </label>
            `;
        });

        document.querySelectorAll('.q-btn').forEach(b => b.classList.remove('current'));
        const currentBtn = document.getElementById(`qbtn-${index}`);
        if(currentBtn) currentBtn.classList.add('current');

        // Locking Logic
        els.btnPrev.disabled = (index === 0) || (Math.floor((index - 1) / SET_SIZE) < state.maxSetReached);

        updatePersistence();
    }

    function selectOption(optIndex) {
        state.answers[state.currentQ] = optIndex;
    }

    function saveAndNext() {
        const index = state.currentQ;
        if (state.answers[index] !== null) {
            state.status[index] = 'answered';
        } else {
            state.status[index] = 'not-answered';
        }
        moveToNextQuestion();
    }

    function markForReview() {
        const index = state.currentQ;
        if (state.answers[index] !== null) {
            state.status[index] = 'marked-answered';
        } else {
            state.status[index] = 'review';
        }
        moveToNextQuestion();
    }

    function clearResponse() {
        state.answers[state.currentQ] = null;
        state.status[state.currentQ] = 'not-answered';
        loadQuestion(state.currentQ);
        renderPalette();
    }

    function moveToNextQuestion() {
        const nextIndex = state.currentQ + 1;
        const currentSet = Math.floor(state.currentQ / SET_SIZE);
        const nextSet = Math.floor(nextIndex / SET_SIZE);

        if (nextSet > currentSet && nextSet <= Math.floor((TOTAL_QUESTIONS-1)/SET_SIZE)) {
            if (!confirm(`You are about to leave Section ${currentSet + 1}. You CANNOT return to these questions once you proceed. Continue?`)) {
                return;
            }
            state.maxSetReached = nextSet;
        }

        if (nextIndex < TOTAL_QUESTIONS) {
            renderPalette();
            loadQuestion(nextIndex);
        } else {
            renderPalette();
            alert("You have reached the last question.");
        }
    }

    function prevQuestion() {
        if (state.currentQ > 0) {
            const prevIndex = state.currentQ - 1;
            if (Math.floor(prevIndex / SET_SIZE) < state.maxSetReached) {
                alert("Previous section is locked.");
                return;
            }
            loadQuestion(prevIndex);
        }
    }

    function renderPalette() {
        els.palette.innerHTML = '';
        for (let i = 0; i < TOTAL_QUESTIONS; i++) {
            let statusClass = state.status[i];
            const isLocked = Math.floor(i / SET_SIZE) < state.maxSetReached;
            const lockedClass = isLocked ? ' locked' : '';

            els.palette.innerHTML += `
                <div id="qbtn-${i}" 
                        class="q-btn ${statusClass}${lockedClass}" 
                        onclick="jumpToQuestion(${i})">
                    ${i + 1}
                </div>
            `;
        }
    }

    function jumpToQuestion(index) {
        if (Math.floor(index / SET_SIZE) < state.maxSetReached) {
            alert("This section is locked.");
            return;
        }
        const targetSet = Math.floor(index / SET_SIZE);
        if (targetSet > state.maxSetReached) {
            alert("You must complete the current section first.");
            return;
        }
        loadQuestion(index);
    }

    let timerInterval;
    function startTimer() {
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            state.timeLeft--;
            const m = Math.floor(state.timeLeft / 60);
            const s = state.timeLeft % 60;
            els.timer.innerText = `${m}:${s < 10 ? '0'+s : s}`;
            
            if (state.timeLeft % 5 === 0) updatePersistence(); 

            if (state.timeLeft <= 0) {
                clearInterval(timerInterval);
                submitExam();
            }
        }, 1000);
    }

    function submitExam() {
        if (confirm("Are you sure you want to submit the exam?")) {
            finishExam();
        }
    }

    function finishExam() {
        clearInterval(timerInterval);
        state.isFinished = true;
        updatePersistence();
        
        els.header.classList.add('hidden');
        els.body.classList.add('hidden');
        els.footer.classList.add('hidden');
        els.result.classList.remove('hidden');
        
        calculateResult();
    }
    
    // Fixed: Added showResult to recover session on reload if finished
    function showResult() {
         els.header.classList.add('hidden');
         els.body.classList.add('hidden');
         els.footer.classList.add('hidden');
         els.result.classList.remove('hidden');
         calculateResult();
    }

    function calculateResult() {
        let correct = 0;
        let wrong = 0;
        let unattempted = 0;
        let score = 0;

        state.answers.forEach((ans, i) => {
            if (ans === null) {
                unattempted++;
            } else if (ans === questions[i].ans) {
                correct++;
                score += 4;
            } else {
                wrong++;
                score -= 1;
            }
        });

        document.getElementById('scoreCard').innerHTML = `
            <h1>Your Score: ${score} / 400</h1>
            <p>Correct: <span style="color:green">${correct}</span> | Wrong: <span style="color:red">${wrong}</span> | Unattempted: ${unattempted}</p>
        `;
    }

    function showDetailedReview() {
        const container = document.getElementById('detailedReview');
        container.style.display = 'block';
        container.innerHTML = '<h3>Detailed Solutions</h3>';
        
        questions.forEach((q, i) => {
            const userAns = state.answers[i];
            const isCorrect = userAns === q.ans;
            const statusColor = userAns === null ? 'gray' : (isCorrect ? 'green' : 'red');
            const statusText = userAns === null ? 'Skipped' : (isCorrect ? 'Correct' : 'Incorrect');

            let optsHtml = '';
            q.opts.forEach((opt, oi) => {
                let style = '';
                if (oi === q.ans) style = 'font-weight:bold; color:green;'; 
                if (oi === userAns && !isCorrect) style = 'font-weight:bold; color:red;'; 
                optsHtml += `<div style="${style}">${oi+1}. ${opt}</div>`;
            });

            container.innerHTML += `
                <div class="review-item">
                    <div style="color:${statusColor}; font-weight:bold; margin-bottom:5px;">Q${i+1}: ${statusText}</div>
                    <div>${q.text}</div>
                    <div style="margin:10px 0; padding-left:15px; border-left:3px solid #ddd;">${optsHtml}</div>
                    <div class="explanation"><strong>Explanation:</strong> ${q.exp}</div>
                </div>
            `;
        });
    }

    function resetExam() {
        localStorage.removeItem('aiims_cbt_state');
        location.reload();
    }

    function updatePersistence() {
        localStorage.setItem('aiims_cbt_state', JSON.stringify(state));
    }
    
    function toggleSidebar() {
        els.sidebar.classList.toggle('active');
    }

    init();
    </script>
</body>
</html>
